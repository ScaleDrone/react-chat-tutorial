(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5557:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(827)}])},827:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f}});var n=s(5893),r=s(9008),a=s.n(r),i=s(9854),l=s.n(i);s(4298);var o=s(7294);function c(e){let{members:t,me:s}=e;return(0,n.jsxs)("div",{className:l().members,children:[(0,n.jsxs)("div",{className:l().membersCount,children:[t.length," user",1===t.length?"":"s"," online"]}),(0,n.jsx)("div",{className:l().membersList,children:t.map(e=>(function(e,t){let{id:s,clientData:r}=e,{username:a,color:i}=r;return(0,n.jsxs)("div",{className:l().member,children:[(0,n.jsx)("div",{className:l().avatar,style:{backgroundColor:i}}),(0,n.jsxs)("div",{className:l().username,children:[a," ",t?" (you)":""]})]},s)})(e,e.id===s.id))})]})}function m(e){let{messages:t,me:s}=e,r=(0,o.useRef)(null);return(0,o.useEffect)(()=>{r&&r.current&&r.current.scrollIntoView({behavior:"smooth"})}),(0,n.jsxs)("ul",{className:l().messagesList,children:[t.map(e=>(function(e,t){let{member:s,data:r,id:a}=e,{username:i,color:o}=s.clientData,c=s.id===t.id,m=c?"".concat(l().messagesMessage," ").concat(l().currentMember):l().messagesMessage;return(0,n.jsxs)("li",{className:m,children:[(0,n.jsx)("span",{className:l().avatar,style:{backgroundColor:o}}),(0,n.jsxs)("div",{className:l().messageContent,children:[(0,n.jsx)("div",{className:l().username,children:i}),(0,n.jsx)("div",{className:l().text,children:r})]})]},a)})(e,s)),(0,n.jsx)("div",{ref:r})]})}class u{startInterval(){this.interval=setInterval(()=>{Date.now()>this.lastUpdate+this.time&&(this.liveState=!1,clearInterval(this.interval),this.interval=null),this.liveState!==this.lastState&&this.trigger()},this.time)}listen(e){this.listeners.push(e)}trigger(){this.lastState=this.liveState,this.listeners.forEach(e=>e(this.liveState))}onChange(e){""===e?this.liveState=!1:(this.liveState=!0,this.interval||(this.startInterval(),this.trigger())),this.lastUpdate=Date.now()}constructor({time:e=1500}={}){Object.assign(this,{lastState:!1,liveState:!1,lastUpdate:Date.now(),listeners:[],time:null,interval:null}),this.time=e}}let d=null;function h(e){let{onSendMessage:t,onChangeTypingState:s}=e,[r,a]=(0,o.useState)("");return(0,o.useEffect)(()=>{null===d&&(d=new u).listen(s)}),(0,n.jsx)("div",{className:l().input,children:(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),a(""),t(r)},children:[(0,n.jsx)("input",{onChange:e=>(function(e){let t=e.target.value;d.onChange(t),a(t)})(e),value:r,type:"text",placeholder:"Enter your message and press ENTER",autoFocus:!0}),(0,n.jsx)("button",{children:"Send"})]})})}function p(e){let{members:t}=e,s=t.map(e=>e.clientData.username);if(0===s.length)return(0,n.jsx)("div",{className:l().typingIndicator});if(1===s.length)return(0,n.jsxs)("div",{className:l().typingIndicator,children:[s[0]," is typing"]});let r=s.slice(0,-1).join(", ")+" and "+s.slice(-1);return(0,n.jsxs)("div",{className:l().typingIndicator,children:[r," are typing"]})}let g=null;function f(){let[e,t]=(0,o.useState)([]),[s,r]=(0,o.useState)([]),[i,u]=(0,o.useState)({username:function(){let e=["autumn","hidden","bitter","misty","silent","empty","dry","dark","summer","icy","delicate","quiet","white","cool","spring","winter","patient","twilight","dawn","crimson","wispy","weathered","blue","billowing","broken","cold","damp","falling","frosty","green","long","late","lingering","bold","little","morning","muddy","old","red","rough","still","small","sparkling","shy","wandering","withered","wild","black","young","holy","solitary","fragrant","aged","snowy","proud","floral","restless","divine","polished","ancient","purple","lively","nameless"],t=["waterfall","river","breeze","moon","rain","wind","sea","morning","snow","lake","sunset","pine","shadow","leaf","dawn","glitter","forest","hill","cloud","meadow","sun","glade","bird","brook","butterfly","bush","dew","dust","field","fire","flower","firefly","feather","grass","haze","mountain","night","pond","darkness","snowflake","silence","sound","sky","shape","surf","thunder","violet","water","wildflower","wave","water","resonance","sun","wood","dream","cherry","tree","fog","frost","voice","paper","frog","smoke","star"],s=e[Math.floor(Math.random()*e.length)],n=t[Math.floor(Math.random()*t.length)];return s+n}(),color:"#"+Math.floor(16777215*Math.random()).toString(16)}),d=(0,o.useRef)();d.current=e;let f=(0,o.useRef)();f.current=s;let _=(0,o.useRef)();return _.current=i,(0,o.useEffect)(()=>{null===g&&function(){(g=new window.Scaledrone("CP97dMHyjwQ5jh5c",{data:_.current})).on("open",e=>{if(e)return console.error(e);_.current.id=g.clientId,u(_.current)});let e=g.subscribe("observable-room");e.on("message",e=>{let{data:s,member:n}=e;if("object"==typeof s&&"boolean"==typeof s.typing){let e=[...f.current],t=e.findIndex(e=>e.id===n.id);e[t].typing=s.typing,r(e)}else t([...d.current,e])}),e.on("members",e=>{r(e)}),e.on("member_join",e=>{r([...f.current,e])}),e.on("member_leave",e=>{let{id:t}=e,s=f.current.findIndex(e=>e.id===t),n=[...f.current];n.splice(s,1),r(n)})}()},[]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(a(),{children:[(0,n.jsx)("title",{children:"Scaledrone Chat App"}),(0,n.jsx)("meta",{name:"description",content:"Your brand-new chat app!"}),(0,n.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,n.jsx)("script",{type:"text/javascript",src:"https://cdn.scaledrone.com/scaledrone.min.js"}),(0,n.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,n.jsx)("main",{className:l().app,children:(0,n.jsxs)("div",{className:l().appContent,children:[(0,n.jsx)(c,{members:s,me:i}),(0,n.jsx)(m,{messages:e,me:i}),(0,n.jsx)(p,{members:s.filter(e=>e.typing&&e.id!==i.id)}),(0,n.jsx)(h,{onSendMessage:function(e){g.publish({room:"observable-room",message:e})},onChangeTypingState:function(e){g.publish({room:"observable-room",message:{typing:e}})}}),(0,n.jsx)("a",{className:l().upsell,href:"https://www.scaledrone.com/blog/tutorial-build-a-reactjs-chat-app/",children:"Real-time React chat using Scaledrone. See full tutorial â†’"})]})})]})}},9854:function(e){e.exports={app:"Home_app__8F103",upsell:"Home_upsell__g2T_e",appContent:"Home_appContent___GVl6",messagesList:"Home_messagesList___Eq0u",messagesMessage:"Home_messagesMessage__bF1TP",currentMember:"Home_currentMember__wDVfO",avatar:"Home_avatar__wIdRJ",username:"Home_username__PiFEJ",messageContent:"Home_messageContent__mSY2S",text:"Home_text__3B15I",members:"Home_members__z83RQ",membersCount:"Home_membersCount__yz9Zp",membersList:"Home_membersList__lm1JC",member:"Home_member__LuclI",typingIndicator:"Home_typingIndicator__9To12"}},9008:function(e,t,s){e.exports=s(2636)},4298:function(e,t,s){s(5442)}},function(e){e.O(0,[774,888,179],function(){return e(e.s=5557)}),_N_E=e.O()}]);